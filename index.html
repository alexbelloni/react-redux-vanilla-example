<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASTEROIDS</title>
</head>

<body>
    <div id="detail"></div>
    <div id="area"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.0.0-beta.1/redux.min.js"></script>
    <script>
        const reducer = Redux.combineReducers({
            asteroids: (state = { selected: -1, items: [] }, action) => {
                if (action.type === "select") {
                    return { items: state.items, selected: action.data }
                }
                if (action.type === "initial") {
                    return { items: action.data, selected: -1 }
                }
                return state;
            }
        })

        const store = Redux.createStore(reducer);

        function render() {
            const state = store.getState();
            document.querySelector("#area").innerHTML = state.asteroids.items.map((s, i) => {
                return `<div id="${i}" style="border:solid;cursor:pointer" class="item-list"><a href="${s["nasa_jpl_url"]}" target="_blank">${s.name}</a>
                    <p>hazardous? ${s["is_potentially_hazardous_asteroid"]}</p>
                    <p>distance (km): ${s["close_approach_data"][0]["miss_distance"]["kilometers"]}</p>
                    <p>diameter (km): ${s["estimated_diameter"]["kilometers"]["estimated_diameter_min"]}</p>
                    <p>velocity (km/h): ${s["close_approach_data"][0]["relative_velocity"]["kilometers_per_hour"]}</p>
                    </div>`
            }).join(' ');
            document.querySelectorAll(".item-list").forEach(x => x.addEventListener("click", () => handleClick(x.id)));

            if (state.asteroids.selected > -1) {
                const s = state.asteroids.items[state.asteroids.selected];
                document.querySelector("#detail").innerHTML =
                    `<p><a href="${s["nasa_jpl_url"]}" target="_blank">${s.name}</a>
                    <p>hazardous? ${s["is_potentially_hazardous_asteroid"]}</p>
                    <p>orbiting: ${s["close_approach_data"][0]["orbiting_body"]}</p>
                    <p>distance (km): ${s["close_approach_data"][0]["miss_distance"]["kilometers"]}</p>
                    <p>magnitude: ${s["absolute_magnitude_h"]}</p>
                    <p>diameter (km): ${s["estimated_diameter"]["kilometers"]["estimated_diameter_min"]}</p>
                    <p>velocity (km/h): ${s["close_approach_data"][0]["relative_velocity"]["kilometers_per_hour"]}</p>
                    </p>`
            }
        }

        render();

        function handleClick(id) {
            store.dispatch({
                type: "select",
                data: id
            });
            render();
        }

    </script>
    <script>
        window.onload = () => {
            fetch("https://api.nasa.gov/neo/rest/v1/feed?start_date=2021-03-28&end_date=2021-03-28&api_key=DEMO_KEY")
                .then(response => response.json())
                .then(data => {
                    store.dispatch({
                        type: "initial",
                        data: data["near_earth_objects"]["2021-03-28"]
                    })
                    render();
                })
                .catch(e => console.log(e.message));

            // const data = {
            //     "near_earth_objects": {
            //         "2021-03-28": [{
            //             "links": { "self": "http://www.neowsapp.com/rest/v1/neo/2012538?api_key=DEMO_KEY" },
            //             "id": "2012538", "neo_reference_id": "2012538", "name": "12538 (1998 OH)",
            //             "nasa_jpl_url": "http://ssd.jpl.nasa.gov/sbdb.cgi?sstr=2012538", "absolute_magnitude_h": 15.9,
            //             "estimated_diameter": {
            //                 "kilometers": {
            //                     "estimated_diameter_min": 1.7561231848,
            //                     "estimated_diameter_max": 3.9268108181
            //                 }, "meters": {
            //                     "estimated_diameter_min": 1756.1231848042,
            //                     "estimated_diameter_max": 3926.8108180856
            //                 }, "miles": {
            //                     "estimated_diameter_min": 1.0912040195,
            //                     "estimated_diameter_max": 2.4400063648
            //                 }, "feet": {
            //                     "estimated_diameter_min": 5761.559189633,
            //                     "estimated_diameter_max": 12883.2380044079
            //                 }
            //             }, "is_potentially_hazardous_asteroid": true,

            //             "close_approach_data": [{
            //                 "close_approach_date": "2021-03-28", "close_approach_date_full":
            //                     "2021-Mar-28 03:07", "epoch_date_close_approach": 1616900820000, "relative_velocity":
            //                 {
            //                     "kilometers_per_second": "15.2475281327", "kilometers_per_hour": "54891.1012777304", "miles_per_hour":
            //                         "34107.1956800431"
            //                 }, "miss_distance": {
            //                     "astronomical": "0.3251860128", "lunar": "126.4973589792",
            //                     "kilometers": "48647134.868672736", "miles": "30227927.9197503168"
            //                 },
            //                 "orbiting_body": "Earth"
            //             }],

            //             "is_sentry_object": false
            //         }, { "links": { "self": "http://www.neowsapp.com/rest/v1/neo/3371743?api_key=DEMO_KEY" }, "id": "3371743", "neo_reference_id": "3371743", "name": "(2007 FC3)", "nasa_jpl_url": "http://ssd.jpl.nasa.gov/sbdb.cgi?sstr=3371743", "absolute_magnitude_h": 25.5, "estimated_diameter": { "kilometers": { "estimated_diameter_min": 0.0211132445, "estimated_diameter_max": 0.0472106499 }, "meters": { "estimated_diameter_min": 21.113244479, "estimated_diameter_max": 47.2106498806 }, "miles": { "estimated_diameter_min": 0.0131191578, "estimated_diameter_max": 0.0293353287 }, "feet": { "estimated_diameter_min": 69.2691770164, "estimated_diameter_max": 154.8905885541 } }, "is_potentially_hazardous_asteroid": false, "close_approach_data": [{ "close_approach_date": "2021-03-28", "close_approach_date_full": "2021-Mar-28 09:52", "epoch_date_close_approach": 1616925120000, "relative_velocity": { "kilometers_per_second": "14.132390039", "kilometers_per_hour": "50876.6041404691", "miles_per_hour": "31612.743278282" }, "miss_distance": { "astronomical": "0.147889665", "lunar": "57.529079685", "kilometers": "22123978.87901355", "miles": "13747203.00914499" }, "orbiting_body": "Earth" }], "is_sentry_object": false }]
            //     }
            // }
            // store.dispatch({
            //     type: "initial",
            //     data: data["near_earth_objects"]["2021-03-28"]
            // })
            // render();
        }

    </script>
</body>

</html>